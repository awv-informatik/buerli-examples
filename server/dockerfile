FROM ubuntu:18.04

RUN apt update && \
  apt install -y curl locales libicu60 libglu1-mesa-dev ocl-icd-opencl-dev && \
  locale-gen en_US.UTF-8 && \
  update-locale LANG=en_US.UTF-8

###############################
## INSTALL node / npm / yarn
###############################

RUN curl -sL https://deb.nodesource.com/setup_12.x | bash
RUN apt install -y nodejs
RUN npm i -g yarn

###############################
## INSTALL / RUN examples server
###############################

ENV SERVER_DIR /buerli
RUN mkdir -p $SERVER_DIR
WORKDIR $SERVER_DIR

COPY ./ $SERVER_DIR
COPY ./docker-res/EnterpriseBaseModeling.ccapp $SERVER_DIR/EnterpriseBaseModeling.ccapp
COPY ./docker-res/package-linux.json $SERVER_DIR/package.json

RUN yarn
RUN chmod -R +x ./node_modules/@awvinf/classcad-linux-x64
RUN cp ./node_modules/@awvinf/classcad-linux-x64/libboost* /lib/x86_64-linux-gnu

CMD yarn start
